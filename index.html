<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiteScout - Find Website Clients</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: white; }
        .font-display { font-family: 'Space Grotesk', sans-serif; }
        .gradient-text { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .business-card { transition: all 0.3s ease; }
        .business-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .mockup-preview { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); }
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1.3); opacity: 0; }
        }
        .scanning::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid #3b82f6;
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        .score-ring { stroke-dasharray: 100; stroke-dashoffset: 100; transition: stroke-dashoffset 1s ease; }
        .error-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .error-modal.hidden { display: none; }
        .error-content { background: #1e293b; border: 1px solid #334155; border-radius: 16px; max-width: 500px; width: 100%; max-height: 80vh; overflow-y: auto; }
        .error-text { white-space: pre-wrap; font-family: monospace; font-size: 13px; line-height: 1.5; }
    </style>
</head>
<body class="min-h-screen">
    <div class="max-w-6xl mx-auto px-6 py-12">

        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="font-display text-5xl font-bold mb-4">
                <span class="gradient-text">SiteScout</span>
            </h1>
            <p class="text-slate-400 text-lg max-w-2xl mx-auto">
                Find small businesses without websites, generate mockups, and draft outreach emails in minutes.
            </p>
        </header>

        <!-- API Key Setup -->
        <div id="apiSetup" class="glass rounded-2xl p-8 mb-8 max-w-xl mx-auto">
            <h2 class="text-xl font-semibold mb-4">Connect Google Places API</h2>
            <p class="text-slate-400 text-sm mb-4">
                Get your free API key at <a href="https://console.cloud.google.com/apis/credentials" target="_blank" class="text-blue-400 hover:underline">Google Cloud Console</a>
            </p>
            <div class="flex gap-3">
                <input type="password" id="apiKey" placeholder="AIzaSy..."
                    class="flex-1 px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl focus:outline-none focus:border-blue-500">
                <button onclick="saveApiKey()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-medium transition">
                    Save
                </button>
            </div>
        </div>

        <!-- Search Form -->
        <div id="searchForm" class="glass rounded-2xl p-8 mb-8 hidden">
            <div class="grid md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-slate-400 mb-2">Location (City, State or ZIP)</label>
                    <input type="text" id="location" placeholder="Boston, MA or 02101"
                        class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl focus:outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-400 mb-2">Business Type</label>
                    <select id="businessType" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl focus:outline-none focus:border-blue-500">
                        <option value="restaurant">Restaurants</option>
                        <option value="hair_care">Hair Salons</option>
                        <option value="contractor">Contractors</option>
                        <option value="dentist">Dentists</option>
                        <option value="lawyer">Lawyers</option>
                        <option value="plumber">Plumbers</option>
                        <option value="electrician">Electricians</option>
                        <option value="spa">Spas & Wellness</option>
                        <option value="gym">Gyms</option>
                        <option value="cafe">Cafes</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-400 mb-2">Search Radius</label>
                    <select id="radius" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl focus:outline-none focus:border-blue-500">
                        <option value="5000">5 miles</option>
                        <option value="10000" selected>10 miles</option>
                        <option value="20000">20 miles</option>
                        <option value="50000">50 miles</option>
                    </select>
                </div>
            </div>
            <button onclick="findBusinesses()" id="searchBtn"
                class="w-full py-4 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl font-semibold text-lg hover:opacity-90 transition">
                Find Businesses
            </button>

            <button onclick="testApiKey()" class="w-full mt-4 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl font-medium transition text-sm">
                Test API Key
            </button>
            
            <button onclick="resetApiKey()" class="w-full mt-4 py-3 text-slate-400 hover:text-white text-sm transition">
                ‚Üê Change API Key
            </button>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden text-center py-16">
            <div class="relative inline-block mb-6">
                <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                <div class="scanning absolute inset-0"></div>
            </div>
            <p class="text-slate-400" id="loadingText">Scanning for businesses...</p>
        </div>

        <!-- Results -->
        <div id="results" class="hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold">Top Prospects</h2>
                <span id="resultCount" class="text-slate-400"></span>
            </div>

            <div id="businessList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Business cards injected here -->
            </div>
        </div>

        <!-- Mockup Generator Modal -->
        <div id="mockupModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
            <div class="bg-slate-900 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b border-slate-800 flex items-center justify-between">
                    <h3 class="text-xl font-bold">Generated Website Mockup</h3>
                    <button onclick="closeMockup()" class="text-slate-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                </div>
                <div class="p-6">
                    <div id="mockupPreview" class="mockup-preview rounded-xl p-8 mb-6">
                        <!-- Mockup content -->
                    </div>
                    <div class="flex gap-3">
                        <button onclick="downloadMockup()" class="flex-1 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-medium transition">
                            Download Screenshot
                        </button>
                        <button onclick="copyEmail()" class="flex-1 py-3 bg-purple-600 hover:bg-purple-700 rounded-xl font-medium transition">
                            Copy Outreach Email
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Modal (Copy-able) -->
        <div id="errorModal" class="error-modal hidden">
            <div class="error-content">
                <div class="p-4 border-b border-slate-700 flex items-center justify-between">
                    <h3 class="font-semibold text-red-400">Error</h3>
                    <button onclick="closeErrorModal()" class="text-slate-400 hover:text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="p-4">
                    <pre id="errorText" class="error-text text-slate-300 bg-slate-900 p-4 rounded-lg overflow-x-auto select-all"></pre>
                    <button onclick="copyErrorText()" class="mt-4 w-full py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-medium transition">
                        Copy Error Message
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Global error handler for Google Maps
        window.gm_authFailure = function() {
            const debugInfo = `API Key: ${apiKey.substring(0, 10)}...\nKey Length: ${apiKey.length}\nTimestamp: ${new Date().toISOString()}`;
            showError('Google Maps API Error: Invalid key or API not enabled.\n\nDEBUG INFO:\n' + debugInfo + '\n\nPlease check:\n1. Your API key is correct (starts with AIza...)\n2. Maps JavaScript API is enabled\n3. Geocoding API is enabled\n4. Places API is enabled\n5. Billing is enabled on your Google Cloud project\n6. Application restrictions are set to "None" or include this website\n\nGo to: console.cloud.google.com/apis/credentials');
        };
        
        let apiKey = localStorage.getItem('sitescout_api_key') || '';
        let currentBusiness = null;
        let generatedMockup = null;
        let currentErrorText = '';
        let placesService = null;
        let geocoder = null;

        // Load Google Maps API
        function loadGoogleMaps() {
            return new Promise((resolve, reject) => {
                if (window.google && window.google.maps) {
                    console.log('Google Maps already loaded');
                    geocoder = new google.maps.Geocoder();
                    const mapDiv = document.createElement('div');
                    mapDiv.style.display = 'none';
                    document.body.appendChild(mapDiv);
                    const map = new google.maps.Map(mapDiv);
                    placesService = new google.maps.places.PlacesService(map);
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places&callback=initGoogleMaps`;
                script.async = true;
                script.defer = true;
                
                // Timeout if it takes too long
                const timeout = setTimeout(() => {
                    reject(new Error('Google Maps API loading timeout (30s). Check if your API key is valid and APIs are enabled.'));
                }, 30000);

                window.initGoogleMaps = () => {
                    clearTimeout(timeout);
                    console.log('Google Maps loaded successfully');
                    geocoder = new google.maps.Geocoder();
                    const mapDiv = document.createElement('div');
                    mapDiv.style.display = 'none';
                    document.body.appendChild(mapDiv);
                    const map = new google.maps.Map(mapDiv);
                    placesService = new google.maps.places.PlacesService(map);
                    resolve();
                };

                script.onerror = (err) => {
                    clearTimeout(timeout);
                    console.error('Script load error:', err);
                    reject(new Error('Failed to load Google Maps API. Check console for details.'));
                };
                
                document.head.appendChild(script);
            });
        }

        // Show error in copy-able modal
        function showError(message) {
            currentErrorText = message;
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorModal').classList.remove('hidden');
        }

        function closeErrorModal() {
            document.getElementById('errorModal').classList.add('hidden');
        }

        function copyErrorText() {
            navigator.clipboard.writeText(currentErrorText).then(() => {
                const btn = event.target;
                const original = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = original, 1500);
            });
        }

        // Templates for different business types
        const templates = {
            restaurant: {
                colors: { primary: '#ef4444', secondary: '#f97316' },
                headline: 'Authentic Cuisine',
                features: ['Fresh Daily Menu', 'Online Reservations', 'Catering Available'],
                cta: 'Book a Table'
            },
            hair_care: {
                colors: { primary: '#8b5cf6', secondary: '#ec4899' },
                headline: 'Transform Your Look',
                features: ['Expert Stylists', 'Online Booking', 'Premium Products'],
                cta: 'Book Appointment'
            },
            contractor: {
                colors: { primary: '#f59e0b', secondary: '#dc2626' },
                headline: 'Quality Craftsmanship',
                features: ['Free Estimates', 'Licensed & Insured', 'Satisfaction Guaranteed'],
                cta: 'Get a Quote'
            },
            dentist: {
                colors: { primary: '#06b6d4', secondary: '#3b82f6' },
                headline: 'Smile With Confidence',
                features: ['Modern Technology', 'Gentle Care', 'Flexible Scheduling'],
                cta: 'Book Consultation'
            },
            lawyer: {
                colors: { primary: '#1e40af', secondary: '#1e3a8a' },
                headline: 'Trusted Legal Guidance',
                features: ['Free Consultation', 'Years of Experience', 'Proven Results'],
                cta: 'Schedule Consultation'
            },
            plumber: {
                colors: { primary: '#0891b2', secondary: '#0e7490' },
                headline: 'Fast, Reliable Service',
                features: ['24/7 Emergency Service', 'Licensed Professionals', 'Upfront Pricing'],
                cta: 'Call Now'
            },
            electrician: {
                colors: { primary: '#eab308', secondary: '#ca8a04' },
                headline: 'Powering Your Home',
                features: ['Licensed Electricians', 'Safety First', 'Fair Pricing'],
                cta: 'Get Estimate'
            },
            spa: {
                colors: { primary: '#10b981', secondary: '#06b6d4' },
                headline: 'Relax & Rejuvenate',
                features: ['Luxury Treatments', 'Expert Therapists', 'Peaceful Atmosphere'],
                cta: 'Book Treatment'
            },
            gym: {
                colors: { primary: '#dc2626', secondary: '#ea580c' },
                headline: 'Transform Your Body',
                features: ['Modern Equipment', 'Personal Training', '24/7 Access'],
                cta: 'Start Free Trial'
            },
            cafe: {
                colors: { primary: '#92400e', secondary: '#b45309' },
                headline: 'Crafted With Love',
                features: ['Artisan Coffee', 'Fresh Pastries', 'Cozy Atmosphere'],
                cta: 'View Menu'
            }
        };

        function init() {
            if (apiKey) {
                loadGoogleMaps().then(() => {
                    document.getElementById('apiSetup').classList.add('hidden');
                    document.getElementById('searchForm').classList.remove('hidden');
                }).catch(err => {
                    console.error('Failed to load Google Maps:', err);
                    showError('Failed to load Google Maps API. Please check your API key.');
                });
            }
        }

        function resetApiKey() {
            localStorage.removeItem('sitescout_api_key');
            apiKey = '';
            document.getElementById('apiSetup').classList.remove('hidden');
            document.getElementById('searchForm').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('apiKey').value = '';
        }

        function testApiKey() {
            const testDiv = document.createElement('div');
            testDiv.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;';
            testDiv.innerHTML = `
                <div style="background:#1e293b;padding:24px;border-radius:16px;max-width:500px;width:100%;border:1px solid #334155;">
                    <h3 style="font-weight:600;margin-bottom:16px;">Testing API Key...</h3>
                    <div id="testResults" style="font-family:monospace;font-size:12px;white-space:pre-wrap;max-height:300px;overflow-y:auto;background:#0f172a;padding:12px;border-radius:8px;"></div>
                    <button onclick="this.closest('div').parentElement.remove()" style="margin-top:16px;width:100%;padding:12px;background:#3b82f6;border-radius:8px;font-weight:500;">Close</button>
                </div>
            `;
            document.body.appendChild(testDiv);
            
            const results = document.getElementById('testResults');
            results.textContent = 'API Key: ' + apiKey.substring(0, 15) + '...\n\n';
            
            // Test 1: Check if key exists
            if (!apiKey) {
                results.textContent += '‚ùå No API key found\n';
                return;
            }
            results.textContent += '‚úì API key found\n';
            
            // Test 2: Try loading Google Maps
            results.textContent += '\nTrying to load Google Maps...\n';
            
            const testScript = document.createElement('script');
            testScript.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=testGoogleMapsCallback`;
            
            window.testGoogleMapsCallback = function() {
                results.textContent += '‚úì Google Maps loaded successfully!\n';
                results.textContent += '\nAPIs appear to be working.\n';
                results.textContent += 'Try searching now!';
            };
            
            testScript.onerror = function() {
                results.textContent += '‚ùå Failed to load Google Maps\n';
                results.textContent += '\nPossible issues:\n';
                results.textContent += '- API key is invalid\n';
                results.textContent += '- Maps JavaScript API not enabled\n';
                results.textContent += '- Billing not enabled\n';
                results.textContent += '- Domain restrictions blocking the request\n';
            };
            
            // Set a timeout
            setTimeout(() => {
                if (!window.google || !window.google.maps) {
                    results.textContent += '‚ùå Timeout - Google Maps did not load within 10 seconds\n';
                }
            }, 10000);
            
            document.head.appendChild(testScript);
        }
        
        async function saveApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (!key.startsWith('AIza')) {
                showError('Please enter a valid Google API key (starts with AIza...)');
                return;
            }
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'Loading...';
            btn.disabled = true;
            
            try {
                // Try loading Google Maps API
                apiKey = key;
                await loadGoogleMaps();
                
                localStorage.setItem('sitescout_api_key', apiKey);
                document.getElementById('apiSetup').classList.add('hidden');
                document.getElementById('searchForm').classList.remove('hidden');
                
            } catch (error) {
                console.error('Failed to load Google Maps:', error);
                showError('Failed to load Google Maps API. Please check:\n1. Your API key is correct\n2. Geocoding API is enabled\n3. Places API is enabled\n4. No strict referrer restrictions\n\nGo to console.cloud.google.com/apis/credentials');
                apiKey = '';
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        async function findBusinesses() {
            const location = document.getElementById('location').value;
            const type = document.getElementById('businessType').value;
            const radius = parseInt(document.getElementById('radius').value);

            if (!location) {
                showError('Please enter a location');
                return;
            }

            if (!geocoder || !placesService) {
                showError('Google Maps not loaded. Please refresh and try again.');
                return;
            }

            document.getElementById('searchForm').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');

            try {
                // Geocode location using Google Maps API
                document.getElementById('loadingText').textContent = 'Finding location...';

                const geoResult = await new Promise((resolve, reject) => {
                    geocoder.geocode({ address: location }, (results, status) => {
                        if (status === 'OK') {
                            resolve(results[0].geometry.location);
                        } else if (status === 'ZERO_RESULTS') {
                            reject(new Error(`Could not find location: "${location}". Try "City, State" format like "Boston, MA"`));
                        } else {
                            reject(new Error(`Geocoding error: ${status}`));
                        }
                    });
                });

                const lat = geoResult.lat();
                const lng = geoResult.lng();

                // Search for businesses using Places API
                document.getElementById('loadingText').textContent = 'Searching businesses...';

                const placeResults = await new Promise((resolve, reject) => {
                    placesService.nearbySearch({
                        location: { lat, lng },
                        radius: radius,
                        type: type
                    }, (results, status) => {
                        if (status === google.maps.places.PlacesServiceStatus.OK) {
                            resolve(results);
                        } else if (status === google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {
                            resolve([]);
                        } else {
                            reject(new Error(`Places API error: ${status}`));
                        }
                    });
                });

                // Filter businesses without websites and get details
                const businesses = [];
                for (const place of placeResults.slice(0, 20)) {
                    document.getElementById('loadingText').textContent = `Checking ${place.name}...`;

                    try {
                        const details = await new Promise((resolve) => {
                            placesService.getDetails({
                                placeId: place.place_id,
                                fields: ['name', 'formatted_phone_number', 'website', 'url', 'rating', 'user_ratings_total', 'photos', 'formatted_address']
                            }, (result, status) => {
                                if (status === google.maps.places.PlacesServiceStatus.OK) {
                                    resolve(result);
                                } else {
                                    resolve(null);
                                }
                            });
                        });

                        if (details && !details.website) {
                            businesses.push({
                                name: details.name,
                                formatted_address: details.formatted_address,
                                formatted_phone_number: details.formatted_phone_number,
                                rating: details.rating,
                                user_ratings_total: details.user_ratings_total,
                                photos: details.photos,
                                score: calculateScore(details)
                            });
                        }
                    } catch (e) {
                        console.log('Error getting details for', place.name, e);
                    }
                }

                if (businesses.length === 0) {
                    showError('No businesses without websites found in this area. Try a different location or business type.');
                    document.getElementById('searchForm').classList.remove('hidden');
                    return;
                }

                // Sort by score and take top 5
                businesses.sort((a, b) => b.score - a.score);
                displayResults(businesses.slice(0, 5));

            } catch (error) {
                console.error('Full error:', error);
                showError('Error: ' + error.message);
                document.getElementById('searchForm').classList.remove('hidden');
            } finally {
                document.getElementById('loadingState').classList.add('hidden');
            }
        }

        function calculateScore(business) {
            let score = 0;

            // Rating (0-30 points)
            if (business.rating) {
                score += business.rating * 6;
            }

            // Review count (0-30 points)
            if (business.user_ratings_total) {
                score += Math.min(business.user_ratings_total / 10, 30);
            }

            // Has phone number (+10)
            if (business.formatted_phone_number) {
                score += 10;
            }

            // Has photos (+20)
            if (business.photos && business.photos.length > 0) {
                score += 20;
            }

            // Established businesses (more reviews = more established)
            if (business.user_ratings_total > 50) {
                score += 10;
            }

            return Math.min(Math.round(score), 100);
        }

        function displayResults(businesses) {
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('resultCount').textContent = `${businesses.length} prospects found`;

            const container = document.getElementById('businessList');
            container.innerHTML = businesses.map((biz, index) => `
                <div class="business-card glass rounded-xl p-6 cursor-pointer" onclick="generateMockup(${index})">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="font-bold text-lg mb-1">${biz.name}</h3>
                            <p class="text-slate-400 text-sm">${biz.formatted_address || ''}</p>
                        </div>
                        <div class="relative w-14 h-14">
                            <svg class="w-14 h-14 transform -rotate-90">
                                <circle cx="28" cy="28" r="24" stroke="#1e293b" stroke-width="4" fill="none"/>
                                <circle cx="28" cy="28" r="24" stroke="${biz.score > 70 ? '#22c55e' : biz.score > 50 ? '#eab308' : '#ef4444'}"
                                    stroke-width="4" fill="none"
                                    stroke-dasharray="150.8"
                                    stroke-dashoffset="${150.8 - (150.8 * biz.score / 100)}"
                                    class="score-ring"/>
                            </svg>
                            <span class="absolute inset-0 flex items-center justify-center text-sm font-bold">${biz.score}</span>
                        </div>
                    </div>

                    <div class="flex items-center gap-4 text-sm text-slate-400 mb-4">
                        ${biz.rating ? `<span>‚≠ê ${biz.rating}</span>` : ''}
                        ${biz.user_ratings_total ? `<span>(${biz.user_ratings_total} reviews)</span>` : ''}
                        ${biz.formatted_phone_number ? `<span>üìû ${biz.formatted_phone_number}</span>` : ''}
                    </div>

                    <button class="w-full py-3 bg-blue-600/20 hover:bg-blue-600/30 border border-blue-600/50 rounded-xl text-blue-400 font-medium transition">
                        Generate Mockup & Email
                    </button>
                </div>
            `).join('');

            // Store businesses for later
            window.foundBusinesses = businesses;
        }

        function generateMockup(index) {
            const business = window.foundBusinesses[index];
            currentBusiness = business;
            const type = document.getElementById('businessType').value;
            const template = templates[type] || templates.restaurant;

            generatedMockup = {
                business,
                template,
                type
            };

            const preview = document.getElementById('mockupPreview');
            preview.innerHTML = `
                <div style="background: linear-gradient(135deg, ${template.colors.primary}20 0%, ${template.colors.secondary}20 100%); padding: 40px; border-radius: 12px;">
                    <nav style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
                        <h1 style="font-size: 24px; font-weight: bold; color: ${template.colors.primary};">${business.name}</h1>
                        <div style="display: flex; gap: 20px; color: #94a3b8;">
                            <span>Home</span>
                            <span>Services</span>
                            <span>About</span>
                            <span>Contact</span>
                        </div>
                    </nav>

                    <div style="text-align: center; padding: 60px 20px;">
                        <h2 style="font-size: 48px; font-weight: bold; margin-bottom: 20px; color: white;">${template.headline}</h2>
                        <p style="font-size: 18px; color: #94a3b8; max-width: 600px; margin: 0 auto 30px;">
                            Professional services you can trust. Serving ${business.formatted_address?.split(',')[1] || 'your area'} with excellence.
                        </p>
                        <button style="background: ${template.colors.primary}; color: white; padding: 16px 32px; border-radius: 8px; font-weight: 600; font-size: 18px; border: none; cursor: pointer;">
                            ${template.cta}
                        </button>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 40px;">
                        ${template.features.map(f => `
                            <div style="background: rgba(255,255,255,0.05); padding: 24px; border-radius: 12px; text-align: center;">
                                <div style="color: ${template.colors.primary}; font-size: 24px; margin-bottom: 12px;">‚úì</div>
                                <p style="color: #e2e8f0; font-weight: 500;">${f}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            document.getElementById('mockupModal').classList.remove('hidden');
        }

        function closeMockup() {
            document.getElementById('mockupModal').classList.add('hidden');
        }

        function downloadMockup() {
            // Use html2canvas or similar in production
            showError('Screenshot feature - integrate html2canvas library');
        }

        function copyEmail() {
            const biz = currentBusiness;
            const email = `Subject: Quick question about ${biz.name}

Hi there,

I was looking for businesses like yours in ${biz.formatted_address?.split(',')[1] || 'the area'} and noticed ${biz.name} doesn't have a website yet.

I help local businesses get online with professional websites that bring in more customers. Here's a quick mockup I made showing what your site could look like: [attach mockup screenshot]

A few things a website could do for you:
‚Ä¢ Show up when people search "${document.getElementById('businessType').value.replace('_', ' ')} near me"
‚Ä¢ Display your services, hours, and contact info 24/7
‚Ä¢ Let customers book appointments or request quotes online
‚Ä¢ Build trust with professional photos and reviews

I build these for $500-1500 depending on what you need. Want to chat for 10 minutes this week?

Best,
[Your Name]

P.S. Your ${biz.rating || 'great'} reviews on Google show you run a quality business - a website would just help more people find you!`;

            navigator.clipboard.writeText(email).then(() => {
                showError('Email copied to clipboard!');
            });
        }

        // Init
        init();
    </script>
</body>
</html>
